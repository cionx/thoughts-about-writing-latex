% ignoring certain warnings
\usepackage{silence}
\WarningFilter{latexfont}{Font shape}
\WarningFilter{latexfont}{Some font shapes were not available, defaults substituted.}


% git information
\usepackage{gitinfo2}

% fixes some float issue with koma
% see https://tex.stackexchange.com/questions/51867/koma-warning-about-toc
\usepackage{scrhack}

% header layout
\usepackage[automark, autooneside=false]{scrlayer-scrpage}

% microtypography
\usepackage{microtype}

% bibliography
\usepackage[backend=biber, style=alphabetic, dateabbrev=false, urldate=long]{biblatex}

% the file containing the references for biblatex
\bibliography{references.bib}
% no unplaned surprises with \cite
\DeclareFieldFormat{postnote}{#1}
\DeclareFieldFormat{multipostnote}{#1}

% better defining commands
\usepackage{xparse}

% configure list environments
\usepackage{enumitem}
\setlist{  
  listparindent=\parindent,
  parsep=0pt,
}

% tables
\usepackage{booktabs}
% \renewcommand{\arraystretch}{1.2}

% more control about tables
\usepackage{multirow}

% mathematical things
\usepackage{mathtools}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{stmaryrd}
\usepackage{extarrows}
\usepackage{centernot}


% ugly fractions
\usepackage{faktor}

% pretty drawings
\usepackage{tikz}
% for trees
\usetikzlibrary{trees}
\usetikzlibrary{shapes.multipart}

% commutative diagram
\usepackage{tikz-cd}

% TeX related logos
\usepackage{hologo}

% scaling text for examples
\usepackage{graphicx}

% loading different languages
% all used languages must be loaded, the standard one last
\usepackage[british, ngerman, french, american]{babel}

% quotation marks
\usepackage[babel = true]{csquotes}

% referencing
\usepackage{hyperref}
\hypersetup{
    colorlinks,
    linkcolor={magenta},
    citecolor={magenta},
    urlcolor={magenta}
}
\usepackage[capitalise, noabbrev]{cleveref}
\crefname{equation}{equation}{equations}


% boxes for examples
\usepackage[listings,xparse,breakable,skins]{tcolorbox}

% setting koma fonts
\setkomafont{disposition}{\normalfont\scshape}
\setkomafont{descriptionlabel}{\normalfont\bfseries}
\setkomafont{publishers}{\normalsize}
\setkomafont{dictumtext}{\itshape\small}
\setkomafont{dictumauthor}{\normalfont}

% further dictum settings
\renewcommand*{\dictumwidth}{0.5\linewidth}

% no subsections in the toc
\setcounter{tocdepth}{2}
% custom commands for disabeling/starting toc
\newcommand{\stoptoc}{\addtocontents{toc}{\protect\setcounter{tocdepth}{-1}}}
\newcommand{\starttoc}{\addtocontents{toc}{\protect\setcounter{tocdepth}{2}}}
% custom command for changing the depth of bibliography
\newcommand{\settocdepth}[1]{\addtocontents{toc}{\protect\setcounter{tocdepth}{#1}}}
% more space for page numbers in the toc, default is 1.55
\renewcommand{\@pnumwidth}{2em}

% formatting of pagetotal in the references
\DeclareFieldFormat[book, manual, article]{pagetotal}{#1~\ppno}

% defining theorem like environments
\newcounter{everything}[section]  % to be used for all kind of math enviroments

\newtheorem{lemma}[everything]{Lemma}
\newtheorem{remark}[everything]{Remark}
\newtheorem{theorem}[everything]{Theorem}

\renewcommand{\theeverything}{\arabic{everything}}

% prevents breaking inline math around binary or relationship symbols
\binoppenalty=\maxdimen
\relpenalty=\maxdimen


%%% playign around with fonts
\usepackage{fontspec}

% first compiling with this font takes 6â€”7 GB, subsequent is back to normal
\newfontfamily{\russianfont}[Scale=MatchUppercase]{Noto Serif CJK JP}
\newcommand{\multilang}[1]{\begingroup \russianfont #1 \endgroup}



%%%%% settings for code examples

% change displayed name at beginning of the list
\renewcommand{\lstlistlistingname}{List of Examples}

% settings for the boxes
\newlength{\normalparindent}
\AtBeginDocument{\setlength{\normalparindent}{\parindent}}
\tcbset{
  examplestyle/.style
  =
  {,
    add to list = {lol}{section},
    breakable,
    enhanced jigsaw,
    before lower={\setlength{\parindent}{\normalparindent}\noindent},
    before={\par\pagebreak[0]\smallskip\noindent},
    after={\par\noindent},
  }
}
% before must be set because after is set, see
% https://tex.stackexchange% settings for the example boxes

% define a common counter
\newcounter{allexamples}[chapter]

% define an environment for compiling examples
\NewTCBListing
[
  use counter = allexamples,
  crefname={Example}{Examples},
  Crefname={Example}{Examples},
  list inside = exam
]
{showlatex}
{ s O{} m }
{%
  examplestyle,
  list entry = {\protect\numberline{\arabic{chapter}.\thetcbcounter} #3},
  IfBooleanTF={#1}
    {listing side text}
    {},
  title = {Example \arabic{chapter}.\thetcbcounter: #3},
  #2
}

% define an environment for listings only examples
\NewTCBListing
[
  use counter = allexamples,
  crefname={Example}{Examples},
  Crefname={Example}{Examples},
  list inside = example
]
{showcode}
{ O{} m }
{%
  listing only,
  examplestyle,
  list entry = {\protect\numberline{\arabic{chapter}.\thetcbcounter} #2},
  title = {Example \arabic{chapter}.\thetcbcounter: #2},
  #1
}

% settings for the code
% tcolorbox uses the listings package, so changes must be done there
\setmonofont[Scale=MatchLowercase]{DejaVu Sans Mono}
% proper indentation for new paragraphs
\newlength{\parindentsave}
% finally setting everything
\AtBeginDocument{\setlength{\parindentsave}{\parindent}}
\lstset{%
  numbers           = left,
  numbersep         = 2pt,
  numberstyle       = \tiny,
  basicstyle        = \small\ttfamily,
  columns           = fixed,
  breaklines        = true,
  breakatwhitespace = true,
  breakindent       = 0pt
}

% footnote symbol in minipages
\renewcommand{\thempfootnote}{\arabic{mpfootnote}}



%%%%% own commands and macros

%\DeclareBibliographyCategory{testentries}
\newcommand{\testcite}[1]{%
  \begin{center}
    \parbox{0.9\linewidth}{\fullcite{#1}}
%    \addtocategory{testentries}{#1}
  \end{center}
}

\RenewDocumentCommand{\TeX}{}{\hologo{TeX}}
\RenewDocumentCommand{\LaTeX}{}{\hologo{LaTeX}}
\NewDocumentCommand{\LuaLaTeX}{}{\hologo{LuaLaTeX}}
\NewDocumentCommand{\XeLaTeX}{}{\hologo{XeLaTeX}}

\NewDocumentCommand{\commandname}{ m }{\texttt{{\textbackslash}#1}}
\NewDocumentCommand{\envname}{}{\texttt}
\NewDocumentCommand{\filename}{}{\texttt}
\NewDocumentCommand{\packagename}{}{\texttt}
\NewDocumentCommand{\inlinecode}{}{\texttt}
\newcommand{\commandtt}[1]{\texttt{{\textbackslash}#1}}

\newcommand{\customtexttilde}{\char`~}

\DeclareMathOperator*{\colim}{colim}
\DeclareMathOperator{\lcm}{lcm}

\newcommand{\nbh}{\nobreakdash-}
\newcommand{\tbs}{\textbackslash}

\DeclarePairedDelimiter{\abs}{\lvert}{\rvert}
\newcommand{\Acat}{\mathcal{A}}
\newcommand{\Ccat}{\mathcal{C}}
\DeclareMathOperator{\Complex}{\mathbb{C}}
\DeclareMathOperator{\End}{End}
\DeclareMathOperator{\Hom}{Hom}
\DeclarePairedDelimiterX{\inner}[2]{\langle}{\rangle}{#1 \,\delimsize\vert\, #2}
\DeclareMathOperator{\Mod}{\mathbf{Mod}}
\DeclarePairedDelimiterXPP{\newnorm}[1]{\mathop{}}{\lVert}{\rVert}{}{#1}
\DeclarePairedDelimiter{\norm}{\lVert}{\rVert}
\newcommand{\Real}{\mathbb{R}}
\DeclareMathOperator{\Word}{Word}
