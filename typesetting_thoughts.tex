\documentclass[a4paper, 10pt, headings=standardclasses, oneside, bibliography=totocnumbered]{scrbook}

\usepackage{stylesheet}

\title{Thoughts About Writing~\hologo{LaTeX}}
\subtitle{Some \hologo{LaTeX} Do’s and Don’ts}
\author{Jendrik Stelzner}
\date{\today}
\publishers{
  Available at \texttt{\url{https://github.com/cionx/thoughts-about-writing-latex}.}
  \\
  Please send comments and corrections to \texttt{\href{mailto:stelzner@uni-bonn.de}{stelzner@uni-bonn.de}.}
}
  
\begin{document}

\frontmatter

\maketitle
\include{chapters/preface}
\tableofcontents


\mainmatter
\include{chapters/general}
\include{chapters/packages}
\include{chapters/punctuation}





\chapter{Others}

\section{Use macros and commands}

Use predefined mathematical operators:
% make teh table nicer with booktabs
\begin{center}
  \begin{tabular}{@{}lclc@{}}
    \toprule
    \multicolumn{2}{c}{Do}
    &
    \multicolumn{2}{c}{Don’t}
    \\
    \cmidrule(r){1-2}
    \cmidrule(l){3-4}
    command
    &
    output
    &
    command
    &
    output
    \\
    \midrule
    \texttt{{\tbs}dim V}
    &
    $\dim V$
    &
    \texttt{dim V}
    &
    $dim V$
    \\
    \texttt{{\tbs}sin(x)}
    &
    $\sin(x)$
    &
    \texttt{sin(x)}
    &
    $sin(x)$
    \\
    \texttt{{\tbs}lim\_\{n {\tbs}to {\tbs}infty\} a\_n}
    &
    $\lim_{n \to \infty} a_n$
    &
    \texttt{lim\_\{n {\tbs}to {\tbs}infty\} a\_n}
    &
    $lim_{n \to \infty} a_n$
    \\
    \bottomrule
  \end{tabular}
\end{center}
New commands can be defined in various ways:



\subsection{\texttt{DeclareMathOperator}}

Commands of the form \commandtt{Word} that give the output $\Word$ can easily be defined using \commandtt{DeclareMathOperator}.
The command \commandtt{DeclareMathOperator} can only be used in the preamble.

To define the command \commandtt{Hom} we us the following text in the preamble:
\begin{tcblisting}{listing only, title={Declaring a math operator}}
% in the preamble:
\DeclareMathOperator{\End}{End}
\end{tcblisting}
The command \commandtt{Hom} can then be used in the usual way:
\begin{tcblisting}{title={Using a declared math operator}}
Thus $\End(V) = \End_k(V)$ becomes a vector space.
\end{tcblisting}
When a command \commandtt{Word} is defined with \commandtt{DeclareMathOperator} then \hologo{LaTeX} automatically inserts some space around \commandtt{Word} when needed:
\begin{tcblisting}{listing side text, title = Automatic spacing of \commandtt{DeclareMathOperator}}
\begin{align*}
&x \End V
\\
&x \End(V)
\\
&x \End {(V)}
\end{align*}
\end{tcblisting}
Note that in the first expression \hologo{LaTeX} inserts some spacing both to the left and to the right of $\End$.
In the second expression \hologo{LaTeX} observes that the used math operator is follows by a parenthesis and thus inserts no additional spacing.
For the third expression we prevent \hologo{LaTeX} from making such an observation by using a pair of curly brackets.


\subsection{\commandtt{operatorname}}

The command \commandtt{operatorname} can be used to give the formatting of a mathemical operator without defining a new command.
\begin{tcblisting}{title={Using \commandtt{operatorname}}}
Thus $\operatorname{Hom}(V,W) = \operatorname{Hom}_k(V,W)$ becomes a vector space.
\end{tcblisting}
If the same command is used multiple times then one should use \commandtt{DeclareMathOperator} instead of \commandtt{operatorname}, as \commandtt{Word} easier to write and read than \commandtt{operatorname{Word}}, and keeps the code clean.

This behavior leads to a bad looking output when \commandtt{DeclareMathoperator} is abused.
Suppose that we want a command \commandtt{Complex} that gives us \commandtt{mathbb{C}}.
Don’t do the following:
\begin{tcblisting}{listing only, title={Abusing \commandtt{DeclareMathOperator}}}
% in the preamble:
\DeclareMathOperator{\Complex}{\mathbb{C}}
\end{tcblisting}
This will lead to the following problem:
\begin{tcblisting}{title = {Wrong Output}}
The span of $x_1, \dotsc, x_n \in \Complex^m$ equals $\Complex x_1 + \dotsb + \Complex x_n$.
\end{tcblisting}
We expect the output $\mathbb{C} x_1 + \dotsb + \mathbb{C} x_n$ but get some unwanted spacing instead.



\subsection{Don’t: \commandtt{mathrm}}

The commands \commandtt{mathrm} and \commandtt{operatorname} do not give the same formatting.
With \commandtt{operatorname} we get necessary spacing when not using parentheses, which does not happen when using \commandtt{mathrm}.
\begin{tcblisting}{listing side text, title={Right vs.\ Wrong}}
Compare $\operatorname{End} V$ to $\mathrm{End} V$.
\end{tcblisting}





\subsection{\commandtt{newcommand}}

A very general way of defining new commands is given by \commandtt{newcommand}.
Its syntax is as follows:
\begin{tcblisting}{listing only, title = {Syntax of \commandtt{newcommand}}}
\newcommand{\name}[n]{ definition including #1, ..., #n }
\end{tcblisting}
Here \texttt{n} is the number of arguments that the defined \commandtt{name} will take.
The arguments can be accessed as \texttt{\#1}, \texttt{\#2}, etc., where \texttt{\#i} is the $i$-th argument.
Consider the following example:
\begin{tcblisting}{title = {Example for \commandtt{newcommand}}}
\newcommand{\bimodule}[2]{#1-#2-bimodule}
Let $M$ be an \bimodule{$A$}{$B$}.
\end{tcblisting}
One may think about \commandtt{DeclareMathOperator} as a combination of \commandtt{newcommand} and \commandtt{operatorname}:
\begin{tcblisting}{title={\commandtt{newcommand} plus \commandtt{operatorname}}}
\newcommand{\Ouv}{\operatorname{Ouv}}
$\Ouv X$
\end{tcblisting}

Trying to define an already existing command with \commandtt{newcommand} will lead to an error.
To overwrite an already existing command one can use \commandtt{renewcommand} instead.
But this shouldn’t really be used (unles you really, \emph{really} know what you’re doing):
Even if you don’t like a particular command there is a chance that some package that you’re using relies on it.
So overwriting a command can easily surprise you with some new problems.



\subsection{\commandtt{DeclarePairedDelimiter}}

One special kind of commands are things like \commandtt{abs\{ \}} for absolute values, which are supposed to put a certain kind of delimiter to the sides of the given argument.
One can use \commandtt{DeclarePaireDelimiter} to define such commands:
\begin{tcblisting}{listing only, title={Using \commandtt{DeclarePairedDelimiter}}}
\DeclarePairedDelimiter{\abs}{\lvert}{\rvert}
\end{tcblisting}
The defined command can then be used as \commandtt{abs\{ \}}:
\begin{tcblisting}{listing side text, title={Using a declared delimiter}}
  \[
    \abs{-5} = 5
  \]
\end{tcblisting}

But \commandtt{DeclarePairedDelimiter} does not only define \commandtt{abs} but also a starred version \commandtt{abs*} that scales the surrounding delimiters according to its content.
One can also specify a scaling size, like \commandtt{big}, \commandtt{bigg}, etc. to scale the delimiters:
\begin{tcblisting}{listing side text, title={Scaling of declaired delimiters}}
\begin{align*}
  \abs{-\frac{1}{2}}
  &=
  \frac{1}{2} \,,
  \\
  \abs*{-\frac{1}{2}}
  &=
  \frac{1}{2} \,,
  \\
  \abs[\bigg]{-\frac{1}{2}}
  &=
  \frac{1}{2}
\end{align*}
\end{tcblisting}

Sometimes one needs a little more control then the basic \commandtt{DeclairePairedDelimiter} offers.
The command \commandtt{DeclarePairedDelimiterX} allows to specify a number of arguments \texttt{[n]} and needs to know how to built up the expression between the delimiters using these specified arguments:
\begin{tcblisting}{listing only, title={Using \commandtt{DeclarePairedDelimiterX}}}
\DeclarePairedDelimiterX{\inner}[2]{\langle}{\rangle}{#1 \,\delimsize\vert\, #2}
\end{tcblisting}
The command \commandtt{delimsize} ensures that the vertical line \commandtt{vert} will be properly scaled when the starred version of the command will be used:
\begin{tcblisting}{title={Using more advanced delimiters}}
\[
  \inner{\psi_1}{\psi_2}
  \quad
  \inner*{\frac{f}{g}}{\frac{h}{k}}
\]
\end{tcblisting}

There is also the even more advanced command \commandtt{DeclarePairedDelimiterXPP}, which also allows to specify code that is to be inserted before the left delimiter and after the right delimiter:
\begin{tcblisting}{listing only, title={Syntax of \commandtt{DeclarePairedDelimiterXPP}}}
\DeclarePairedDelimiterXPP{\name}[n]{left code}{left delimiter}{right delimiter}{right code}{inner code}
\end{tcblisting}
Suppose for example that we have defined a command \commandtt{norm} as follows:
\begin{tcblisting}{listing only, title={Defining \commandtt{norm}}}
\DeclarePairedDelimiter{\norm}{\lVert}{\rVert}
\end{tcblisting}
This will lead to the following output:
\begin{tcblisting}{listing side text, title={Using \commandtt{norm}}}
\[
  \norm{f}
  =
  \sup_{x \in I} \norm{f(x)}
\]
\end{tcblisting}
Note that there seems to be some space missing between the expressions $\sup$ and $\norm{f(x)}$.
This may seem surprising at first but makes sense:
In the similar expression $\sup(M)$ we dont expect any space between \commandtt{sup} and the following left delimiter \texttt{(}, so here we also don’t get any spacing between \commandtt{sup} and the following left delimiter \commandtt{lVert}.
We can circumvent this problem by adding an empty use of \commandtt{mathop} in between.
We can do this by using \commandtt{DeclarePairedDelimiterXPP} to insert \commandtt{mathop\{\}} before the left delimiter:
\begin{tcblisting}{listing only, title={Using \commandtt{DeclarePairedDelimiterXPP}}}
\DeclarePairedDelimiterXPP{\newnorm}[1]{\mathop{}}{\lVert}{\rVert}{}{#1}
\end{tcblisting}
The output now looks as follows:
\begin{tcblisting}{listing side text, title={Using \commandtt{newnorm}}}
\[
  \newnorm{f}
  =
  \sup_{x \in I} \newnorm{f(x)}
\]
\end{tcblisting}
This approach is motivated by \cite{tex_advancedpair}.

More information on \commandtt{DeclarePairedDelimiter} can be found in the \texttt{mathtools} manual.



\subsection{Package: \texttt{xparse}}

A useful way for defining more involved macros is the \texttt{xparse} package.
This package provides the \commandtt{NewDocumentCommand} command, which can be used to define new commands.
The syntax of \commandtt{NewDocumentCommand} is as follows:
\begin{tcblisting}{listing only, title={Syntax of \commandtt{NewDocumentCommand}}}
\NewDocumentCommand{\name}{arguments}{definition}
\end{tcblisting}
Instead of giving the number of arguments (as done for \commandtt{newcommand}) we say what kind of arguments will be given.
There are four possible kinds of argument:
\begin{itemize}
  \item
    \texttt{s} if a starred version of the argument should also be defined,
  \item
    \texttt{o} for optional arguments,
  \item
    \texttt{O} for optional arguments that admit a default value
  \item 
    \texttt{m} for mandatory arguments.
\end{itemize}
Mandatory arguments are given in curly brackets \texttt{\{ \}} and optional arguments are given in square brackets \texttt{[ ]}.
This is most easy to understand through some examples:

\subsubsection{First example}

\begin{tcblisting}{listing only, title={Starred version and two mandatory argument}}
\NewDocumentCommand{\restrict}{smm}{
  \IfBooleanTF{#1}
    {\left. {#2} \right|_{#3}}
    {#2|_{#3}}
}
\end{tcblisting}
% define the command
\NewDocumentCommand{\restrict}{smm}{
  \IfBooleanTF{#1}
    {\left. {#2} \right|_{#3}}
    {#2|_{#3}}
}
The letter \texttt{s} ensures that the code defines both the command \commandtt{restrict} and its starred version \commandtt{restrict*}.
Both of these take two mandatory arguments.
The following part checks which version of the command is used:
\begin{tcblisting}{listing only, title={Checking for starred version}}
\IfBooleanTF{#1}{ starred command }{ non-starred command }
\end{tcblisting}
So \commandtt{restrict\{f\}\{X\}} gives the code \texttt{f|\_\{X\}} whereas \commandtt{restrict*\{f\}\{X\}} gives the following code:
\begin{center}
  \texttt{{\tbs}left. f {\tbs}right|\_\{X\}}
\end{center}
We get the following output:
\begin{tcblisting}{listing side text, title={Using \commandtt{restrict}}}
\[
  \restrict{f}{X}
  \quad
  \restrict{\frac{f}{g}}{X}
  \quad
  \restrict*{\frac{f}{g}}{X}
\]
\end{tcblisting}

\subsubsection{Second example}

The following is modified version of the previous example:
\begin{tcblisting}{listing only, title={Starred version, two mandatory arguments, one option argument with (empty) standard value}}
\NewDocumentCommand{\restrict}{smmO{}}{
\IfBooleanTF{#1}
  {\left. {#2} \right|_{#3}^{#4}}
  {{#2} |_{#3}^{#4}}
}
\end{tcblisting}
% redefine the command
\RenewDocumentCommand{\restrict}{smmO{}}{
\IfBooleanTF{#1}
  {\left. {#2} \right|_{#3}^{#4}}
  {{#2} |_{#3}^{#4}}
}
The command now takes an optional third argument.
If this optional argument is not set then it takes on its standard value, which is empty.
\begin{tcblisting}{listing side text, title={Using the enhanced version of \commandtt{restrict}}}
\[
  \restrict{f}{X}
  \quad
  \restrict{f}{X}[Y]
  \quad
  \restrict*{\frac{f}{g}}{X}
  \quad
  \restrict*{\frac{f}{g}}{X}[Y]
\]
\end{tcblisting}

\subsubsection{Third example}

The following command takes two mandatory arguments and two optional arguments, whose standard values are empty:
\begin{tcblisting}{listing only, title={Two optional arguments with (empty) standard value, one mandatory argument}}
\NewDocumentCommand{\moduleindex}{O{} m O{}}{
  {}_{#1} #2_{#3}
}
\end{tcblisting}
\NewDocumentCommand{\moduleindex}{O{} m O{}}{
  {}_{#1} #2_{#3}
}
The output is as follows:
\begin{tcblisting}{listing side text, title={Using \commandtt{moduleindex}}}
\[
  \moduleindex{M}
  \quad
  \moduleindex[R]{M}
  \quad
  \moduleindex{M}[S]
  \quad
  \moduleindex[R]{M}[S]
\]
\end{tcblisting}

\subsubsection{Fourth example}

The following example takes an optional argument with no standard value.
So it has to be checked if this optional argument was assigned a value.
\begin{tcblisting}{listing only, title={One mandatory argument, one optional argument without standard value}}
\NewDocumentCommand{\module}{m o}{
  \IfNoValueTF{#2}{{#1}-module}
                  {{#1}-{#2}-bimodule}
}
\end{tcblisting}
% overwrite the command
\NewDocumentCommand{\module}{m o}{%
  \IfNoValueTF{#2}{{#1}-module}
                  {{#1}-{#2}-bimodule}%
}
This command works as follows:
\begin{tcblisting}{title={Using\commandtt{module}}}
Let $M$ be an \module{$R$} and let $N$ be an \module{$R$}[$S$].
\end{tcblisting}





\section{Define theorem-like environments with \texttt{amsthm}}
\label{defining theorem like environments}

To define theorem-like environments, like \texttt{lemma}, \texttt{proposition}, \texttt{theorem}, etc., include the package \texttt{amsthm}.
New environments can then be defined with the \commandtt{newtheorem} command:
\begin{tcblisting}{listing only, title = {Syntax of \commandtt{newtheorem)}}}
\newtheorem{name of the environment}{title to be printed}
\end{tcblisting}
\begin{tcblisting}{title = {Use of \commandtt{newtheorem}}}
% in the preamble
\newtheorem{proposition}{Proposition}
% in the main body
\begin{proposition}
  Every finite subgroup of $k^\times$ is cyclic.
\end{proposition}
\end{tcblisting}
The variant \commandtt{newtheorem*} defines unnumbered theorem-like environments:
\begin{tcblisting}{title = {Use of \commandtt{newtheorem*}}}
% in the preamble
\newtheorem*{claim}{Claim}
% in the main body
\begin{claim}
  The symmetric group $S_3$ is the smallest non-abelian group.
\end{claim}
\end{tcblisting}

If different numbered theorem-like environments are defined then their have different counters:
\begin{tcblisting}{title = {Different counters}}
%in the preamble
\newtheorem{idea}{Idea}
\newtheorem{problem}{Problem}
%in the main text
\begin{idea}
  Fly to the moon in a car.
\end{idea}
\begin{problem}
  Cars don’t fly.
\end{problem}
\end{tcblisting}
For mathematical texts this behavior is pretty bad, as it makes it harder to find a specified result.
(If page~492 features Lemma~112 and Proposition~43 then have fun finding Remark~20.)

To solve this problem we define a new counter \texttt{alltheorems} and tell all theorem-like environments to use this counter:
\begin{tcblisting}{title = {Setting a common counter}}
% in the preamble
\newcounter{alltheorems}

\newtheorem{assumption}[alltheorems]{Assumption}
\newtheorem{consequence}[alltheorems]{Consequence}

% in the main text
\begin{assumption}
  Cats hunt mice.
\end{assumption}

\begin{assumption}
  Tigers are cats.
\end{assumption}

\begin{consequence}
  Tigers hunt mice.
\end{consequence}
\end{tcblisting}

In praxis one often wants the counter to be bound to the surround section or even chapter.
This can be achived with the following modification:
\begin{tcblisting}{title = {Binding the counter to section}}
% in the preamble
\newcounter{sometheorems}[section]
\renewcommand{\thesometheorems}{\arabic{section}.\arabic{sometheorems}}
\newtheorem{corollary}[sometheorems]{Corollary}

% in the main text
\begin{corollary}
  Every subgroup of a free abelian group is again free abelian.
\end{corollary}

\begin{corollary}
  Every subgroup of $\mathbb{Z}^n$ admits a basis.
\end{corollary}

\end{tcblisting}
The addition \texttt{[section]} to the definition of the new counter ensures that the resulting counter \texttt{sometheorems} resets every time the counter \texttt{section} is increased (which happens everytime a new section begins).
We also change the way the \texttt{sometheorems} counter is printed, namely printing it in the form \texttt{\{section number\}.\{counter number\}} with both numbers printed in arabic numbers.








\section{Use referencing}

To refer to a numbered part of the document, like a theorem, an item of a list, a chapter or a section, one shoud never write down this number explicitely in the code.
The referencing system of \hologo{LaTeX} should be used instead.
Using this referencing system always consists of two steps:
Setting a label at the position that you want to refer to, and then referencing this label at the desired position.



\subsection{\commandtt{label} and \commandtt{ref}}

The command for setting a label is \commandtt{label}.
There are multiple commands for referencing this label, the most basic of which is \commandtt{ref}.
The use of \commandtt{ref\{label name\}} will print the number of whatever \commandtt{label\{label name\}} is set at.
\begin{tcblisting}{listing side text, title = {Basic referencing}}
\begin{theorem}
    \label{vector spaces are free}
    Every vector space admits a basis.
\end{theorem}
It follows from \ref{vector spaces are free} that two vector spaces are isomorphic if and only if they have the same dimension.
\end{tcblisting}

Instead of giving just a simple number one normally gives also the name of the refered to environment.
In this case the name and number should be seperated by \texttt{~} to ensure that no line break occurs at this position.
Consider the following two examples:
\begin{tcblisting}{listing side text, title = {Wrong}}
\begin{theorem}
    \label{every vs has a basis}
    Every vector space admits a basis.
\end{theorem}
It follows from the above Theorem \ref{every vs has a basis} that two vector spaces are isomorphic if and only if they have the same dimension.
\end{tcblisting}
\begin{tcblisting}{listing side text, title = {Wrong}}
\begin{theorem}
    \label{every vector space has a basis}
    Every vector space admits a basis.
\end{theorem}
It follows from the above Theorem~\ref{every vector space has a basis} that two vector spaces are isomorphic if and only if they have the same dimension.
\end{tcblisting}

To refer to an equation it is customary to put the resulting number in parentheses.
This can automatically done by using \commandtt{eqref} instead of simply \commandtt{ref}.
\begin{tcblisting}{listing side text, title = {Using \commandtt{eqref}}}
  A classic result in mathematics is the equation
  \begin{equation}
    \label{important formula}
    1 + 1 = 2 \,.
  \end{equation}
  Note that the identity \eqref{important formula} shows that Fermat’s conjecture on $a^n + b^n = c^n$ cannot be generalized to $n = 1$.
  (One can similarly show that the conjecture fails for $n = 2$.)
\end{tcblisting}

Always use descriptive labels.
Cryptic sequences of letters will backfire on you.


\subsection{Use \texttt{cleveref}}

There are two related problems with the above way of using \texttt{Type~{\tbs}ref\{label name\}}:
One has to remember or look up what type of environment the label \texttt{label name} refers to, and if this type is changed (e.g.\ by changing a theorem into a proposition) then the references need to be manually adjusted.

These problems can be circumvented by using the \texttt{cleveref} package.
This package provides the command \commandtt{cref} which automatically keeps track of which kind of environment the specified label refers to.
The author recommends the options \texttt{capitalise} and \texttt{noabbrev}.
\begin{tcblisting}{title = {Use of \commandtt{cref}}}
\begin{lemma}
  \label{dim is well-defined}
  Every two bases of a vector space have the same cardinality.
\end{lemma}

\begin{remark}
  One can generalize \cref{dim is well-defined} to non-commutative rings:
  If $R$ is some ring and $M$ is a semisimple $R$-module then for every irreducible $R$-module $S$ the multiplicity of $S$ in $M$ is well-defined.
\end{remark}
\end{tcblisting}

The variant \commandtt{Cref} ensures that the inserted name is capitalised.
It should be used at the beginning of a sentence, even if the option \texttt{capitalise} already ensures that every inserted name is capitalised.



\subsection{Use \texttt{hyperref}}

If the resulting \texttt{pdf} file is supposed to be navigated digitally then the \texttt{hyperref} package should be used.
This package puts clickable links in the pdf file whenever some kind of reference is used.



\subsection{Order of inclusion}

The packages \texttt{cleveref} and \texttt{hyperref} are a bit peculiar in the order that they have to be included into the preamble:

The general rule is that the \texttt{hyperref} should be included as the last package to ensure that it interacts properly with all other packages.
There are some rare exceptions to this rule, one of which happened to be \texttt{cleveref}.

If you’re defining some common counter for your theorem-like environments (which you should do, as explained in \cref{defining theorem like environments}) then this needs to be done after \texttt{cleverref} was included.
Otherwise the \texttt{cleveref} package has problems knowing what name to print when \commandtt{cref} is used.

Overall your preamble should the following order for these things:
\begin{tcblisting}{listing only, title={Order of inclusion}}
% most packages
\usepackage{amsthm}

% the last packages
\usepackage{hyperref}
\usepackage{cleveref}

% defining theorem-like environments
\newcounter{everything}
\newtheorem{theorem}[everything]{Theorem}
\end{tcblisting}





\section{Use \texttt{\%} to comment out problematic line breaks}

Sometimes a sesible line break in your source code can lead to unwanted effects in the resulting output.
Consider the following example:
The resulting output will actually looks as follows:
\begin{tcblisting}{listing side text, title={Wrong}}
Here is some text.
\footnote{Here is a footnote for this text.}
\end{tcblisting}
Note the unwanted space between the end of the sentence and the superscript of the footnote.
This unwanted space comes from the line break in the source code.
By ending the first line with \texttt{\%} we can \enquote{comment out} this line break.
We hence do the following:
\begin{tcblisting}{listing side text, title={Right}}
Here is some text.%
\footnote{Here is a footnote for this text.}
\end{tcblisting}





\section{A mathematical text is a text}
\label{a mathematical text is a text}

To quote \cite{mathoverflow_text}:

\begin{center}
  \enquote{A mathematical text is, before everything else, a text.}
\end{center}

This means in particular that a mathematical text has to obey the rules of the language that is it written in (e.g.\ English, French, German or Russian).
It also means that mathematical equations are part of the surrounding text.





\section{Be consistent}

One of the most important aspects of mathematical writing and use of mathematical notation is consistency.
If you’re making crappy choices then at least do them consistently in the same way.
Let’s look at two counterexamples:

\begin{tcblisting}{title = {Bad}}
% in the preamble:
\newcommand{\glie}{\mathfrak{g}}
% in the main text:
The algebra $U(\glie)$ is commutative if and only if the original Lie algebra $\glie$ is abelian.
But $\operatorname{U}(\glie)$ is infinite dimensional whenever $\glie$ is nonzero, even if $\glie$ itself is finite dimensional as well.
\end{tcblisting}
Even if the reader doesn’t care if you use $U(\mathfrak{g})$ or $\operatorname{U}(\mathfrak{g})$ they will notice the inconsistent use of the two notations, and this will distract them from the actual content of the text.

We consider another example:
\begin{tcblisting}{title = {Bad}}
If $X$ and $Y$ are two objects in a category $\mathcal{C}$ then it may happen that the set $\operatorname{Hom}_{\mathcal{C}}(X,Y)$ is empty even though the set $Hom_{\mathcal{C}}(Y,X)$ is non-empty.
\end{tcblisting}
Even worse then the use of $Hom_{\Ccat}$ is the inconsistency between $\operatorname{Hom}_{\Ccat}$ and $\operatorname{Hom}$.






















\section{Don’t use \texttt{\tbs\tbs} or \texttt{{\tbs}newline}}

The proper way to separate two succeeding paragraphs in \hologo{LaTeX} is to leave an empty line between them.
\begin{tcblisting}{listing side text, title={Right}}
This is the first pagraph.
It consists of multiples lines to make this example better.

This is a second paraph.
It also consists of multiple lines to make this example even more better.

This one is the third and last paragraph in this example.
It also consists of multiple lines.
\end{tcblisting}
Note that a new paragraph starts indented.

The use of \texttt{\tbs\tbs} or \texttt{{\tbs}newline} doesn’t actually end a paragraph but instead forces \hologo{LaTeX} to continue at the beginning of a new line.
\begin{tcblisting}{listing side text, title={Wrong}}
This is the first paragraph in a counterexample.\\
This is not a new paragraph.
The text was just forced to start a new line.\newline
This one is also not a new paragraph.
But this whole thing looks ugly.
\end{tcblisting}
The use of \texttt{\tbs\tbs} and \texttt{{\tbs}newline} is only for starting new rows in matrices, tables and arrays.
Don’t use is to separate paragraphs.





\section{Don’t begin a sentence with a mathematical symbol}

Don’t begin a sentence with a mathematical symbol.
Consider the following example:
\begin{tcblisting}{title = {Wrong}}
\begin{theorem}
  $\mathbf{Mod}(R)$ is an abelian category.
\end{theorem}
\end{tcblisting}
Instead do the following:
\begin{tcblisting}{title = {Right}}
\begin{theorem}
  The category $\mathbf{Mod}(R)$ is abelian.
\end{theorem}
\end{tcblisting}

An exception to the above rule are lists, in which short entries may start with a math symbol.
Consider for this the following example.
\begin{tcblisting}{title = {Okay}}
Let $V$ be a finite dimensional vector space.
Let $U$ and $W$ be linear subspaces of $V$ of complementary dimensions, i.e.\ with $\dim V = \dim U + \dim W$.
Then the following conditions are equivalent:
\begin{enumerate}[label = \roman*)]
  \item
    $V = U \oplus W$,
  \item
    $V = U + W$,
  \item
    $V = U \cap W$.
\end{enumerate}
\end{tcblisting}





\section{Don’t break inline math}
\label{breaking inline math}

When inline formulas or equations are too long or badly placed then it can happen that a line break occurs, tearing the formula apart:
% standard values for penalities, for the demonstration
\begin{tcblisting}{title = {Wrong}, before lower = {\binoppenalty=100}, after lower = {\binoppenalty = \maxdimen}}
The most important formula of all times is without a doubt is my mind $1 + 2 + 3 + 4 = 10 - 5$.
Truly a work of genius!
\end{tcblisting}
This horrible affront to nature can thankfully be completely stopped by raising the corresponding penalties to their (literal) maximum:
\begin{tcblisting}{title = {Right}}
% in the preamble:
\binoppenalty = \maxdimen
\relpenalty = \maxdimen
% in the main text:
The most important formula of all times is without a doubt is my mind $1 + 2 + 3 + 4 = 10 - 5$.
Truly a work of genius!
\end{tcblisting}
(One can in also lower these penalities to ensure a really bad looking first example.)


% \section{Don’t use inline for long formulas}
% 
% The change in \cref{breaking inline math} tends to lead to problems with long formulas or equations, as the surrounding text has to be arranged in a way that they are contained in a single line.
% This is a feature of \cref{breaking inline math}:
% If formulas and equations are too long then they should be put into display mode, not inline mode!
% Compare the following two examples:
% \begin{LTXexample}[pos = b]
%   Suppose that you have already written a bunch of text.
%   Now you start talking about the inequality $\lcm([L_1 : K],[L_2 : K]) \leq [L_1 L_2 : K] \leq [L_1 : K] [L_2 : K]$,
%   which is a bit long.
%   The surrounding text doesn’t really help when you want to focus on the formula.
% \end{LTXexample}
% \begin{LTXexample}[pos = b]
%   Suppose that you have already written a bunch of text.
%   Now you start talking about the inequality
%   \[
%           \lcm([L_1 : K],[L_2 : K])
%     \leq  [L_1 L_2 : K]
%     \leq  [L_1 : K] [L_2 : K]
%   \]
%   which is a bit long.
%   Now the surrounding text doesn’t matter when you want to focus on the formula.
% \end{LTXexample}





% \section{Put important things in display mode}
% 
% Putting mathematical content in display mode distinguishes it from the surrounding text.
% This can be used to emphasize its importance.
% It therefore makes sense to put certain contents into display mode even though it’s short and can reasonable fit into inline mode.
% 
% \begin{LTXexample}[pos = b]
%   If $I$ is an ideal in a commutative ring $R$ and $M$ is an $R$-module then
%   \[
%     (R/I) \otimes_R M
%     \cong
%     M / IM \,.
%   \]
%   This will turn out to be a rather useful identity.
% \end{LTXexample}





\section{Beware of spacings}

When typesetting a document \hologo{LaTeX} groups the appearing symbols and expressions into different groups and then adds spacing around these symbols and expressions depending on which group they belong to.
Three of these groups are \emph{operators}, \emph{relation symbols} and \emph{binary operations}.
The symbols~\texttt{=} and~\texttt{<} are for example treated as relations symbols, and the symbols~\texttt{+} and~\commandtt{cdot} as binary operations.
We can see in the following example how some space is automatically added around these symbols:
\begin{tcblisting}{listing side text, title = {Standard spacing}}
\[
  a = b
  \quad
  a < b
  \quad
  a + b
  \quad
  a \cdot b
\]
\end{tcblisting}
To compare this to a version without spacing we can surround the symbols by a pair of curly brackets.
This circumvents \hologo{LaTeX} from taking the surround code into consideration.
This leads to the following result:
\begin{tcblisting}{listing side text, title = {Without spacing}}
\[
  a {=} b
  \quad
  a {<} b
  \quad
  a {+} b
  \quad
  a {\cdot} b
\]
\end{tcblisting}
The automatic spacing can become a problem, as the following examples illustrate:
\begin{tcblisting}{listing side text, title = {Wrong: clashing spacing}}
\[
  X/\sim
  \quad
  R/\operatorname{J}(R)
  \quad
  \operatorname{id} \otimes h
\]
\end{tcblisting}
This problem can be fixed by surround the respective symbols in curly brackets.
\begin{tcblisting}{listing side text, title = {Right: controlling spacing}}
\[
  X/{\sim}
  \quad
  R/{\operatorname{J}(R)}
  \quad
  {\operatorname{id}} \otimes h
\]
\end{tcblisting}
One can tell \hologo{LaTeX} how to treat a certain symbol:
\begin{tcblisting}{listing side text, title = {Specifying the role}}
\[
  a | b
  \quad
  a \mathop{|} b
  \quad
  a \mathrel{|} b
  \quad
  a \mathbin{|} b
\]
\end{tcblisting}
To define a command \commandtt{divides} to express that a number $n$ divides a number $m$ we do therefore do the following:
\begin{tcblisting}{listing only, title = {Defining \commandtt{divides}}}
\newcommand{\divides}{\mathrel{|}}
\end{tcblisting}
For more on this topic see \cite{tex_binrel}.





\section{Use the right symbols and commands}

Use the right symbols.
\begin{center}
\begin{tabular}{@{}clclc@{}}
    \toprule
    \textbf{symbol}
    &
    \multicolumn{2}{c}{\textbf{right command}}
    &
    \multicolumn{2}{c}{\textbf{wrong command}}
  \\
  \midrule
    element relation
    &
    \commandtt{in}
    &
    $\in$
    &
    \commandtt{epsilon}
    &
    $\epsilon$
  \\
    {}
    &
    {}
    &
    {}
    &
    \commandtt{varepsilon}
    &
    $\varepsilon$
  \\
  \midrule
    empty set
    &
    \commandtt{emptyset}
    &
    $\emptyset$
    &
    \commandtt{phi}
    &
    $\phi$
  \\
  \midrule
    set difference
    &
    \texttt{A {\tbs}setminus B}
    &
    $A \setminus B$
    &
    \texttt{A {\tbs}backslash B}
    &
    $A \backslash B$
  \\
    {}
    &
    \texttt{A {\tbs}smallsetminus B}
    &
    $A \smallsetminus B$
    &
    {}
    &
    {}
  \\
    {}
    &
    \texttt{A - B}
    &
    $A - B$
    &
    {}
    &
    {}
  \\
  \midrule
    implication
    &
    \commandtt{implies}
    &
    $\implies$
    &
    \commandtt{Rightarrow}
    &
    $\Rightarrow$
  \\
    {}
    &
    {}
    &
    {}
    &
    \texttt{=>}
    &
    $=>$
  \\
    {}
    &
    \commandtt{impliedby}
    &
    $\impliedby$
    &
    \commandtt{Leftarrow}
    &
    $\Leftarrow$
  \\
    {}
    &
    {}
    &
    {}
    &
    \texttt{<=}
    &
    $<=$
  \\
  \midrule
    equivalence
    &
    \commandtt{iff}
    &
    $\iff$
    &
    \commandtt{Leftrightarrow}
    &
    $\Leftrightarrow$
  \\
  \midrule
    definition
    &
    \commandtt{coloneqq}
    &
    $\coloneqq$
    &
    \texttt{:=}
    &
    $:=$
  \\
    {}
    &
    \commandtt{eqqcolon}
    &
    $\eqqcolon$
    &
    \texttt{=:}
    &
    $=:$
  \\
  \midrule
    norm
    &
    \texttt{{\tbs}| x {\tbs}|}
    &
    $\| x \|$
    &
    \texttt{|| x ||}
    &
    $|| x ||$
  \\
    {}
    &
    \texttt{{\tbs}lVert x {\tbs}rVert}
    &
    {}
    &
    {}
    &
    {}
  \\
  \midrule
    pointy brackets
    &
    \texttt{{\tbs}langle x {\tbs}rangle}
    &
    $\langle x \rangle$
    &
    \texttt{< x >}
    &
    $< x >$
  \\
  \midrule
    infinity
    &
    \commandtt{infty}
    &
    $\infty$
    &
    \texttt{oo}
    &
    $oo$
  \\
    {}
    &
    {}
    &
    {}
    &
    \texttt{OO}
    &
    $OO$
  \\
    {}
    &
    {}
    &
    {}
    &
    \texttt{00}
    &
    $00$
  \\
  \midrule
    zero
    &
    \texttt{0}
    &
    $0$
    &
    \texttt{O}
    &
    $O$
  \\
    {}
    &
    {}
    &
    {}
    &
    \texttt{o}
    &
    $o$
  \\
  \midrule
    function colon
    &
    \texttt{f {\tbs}colon X {\tbs}to Y}
    &
    $f \colon X \to Y$
    &
    \texttt{X {\tbs}to Y}
    &
    $f : X \to Y$
  \\
  \bottomrule
\end{tabular}
\end{center}
Both \commandtt{rightarrow} and \commandtt{to} give the same arrow.
So use whichever is more appropriate in the given situation.





\section{Use \commandtt{text}}

When text needs to be used in math mode use \commandtt{text}.
The following is horrible:
\begin{tcblisting}{title = {Wrong}}
Let $A \coloneqq \{ x \in [0,1] : x \; is \; rational \}$.
\end{tcblisting}
This next one looks a bit better, but is still not okay:
\begin{tcblisting}{title = {Still wrong}}
Let $A \coloneqq \{ x \in [0,1] : x \text{ is rational} \}$.
\end{tcblisting}
Instead do this:
\begin{tcblisting}{title = {Right}}
% in the preamble:
\newcommand{\defined}{\coloneqq}
\newcommand{\sothat}{\mathrel{:}}
% in the main text:
Let $A \defined \{ x \in [0,1] \sothat \text{$x$ is rational} \}$.
\end{tcblisting}





\section{Don’t force fancy fractions}

When fractions are placed inline, as an exponent or in an index then they should be of the form $a/b$.
The notation
\[
  \frac{a}{b}
\]
is reserved for display style.
So don’t do the following:
\begin{tcblisting}{title = {Wrong}}
Consider $e^{\frac{1}{x}}$ and $x_{\frac{1}{n}}$ and $\frac{2}{3}$.
\end{tcblisting}
Do the following instead:
\begin{tcblisting}{title = {Right}}
Consider $e^{1/x}$ and $x_{1/n}$ and $2/3$.
\end{tcblisting}

Don’t use funky fractions like $\faktor{a}{b}$, they’ll burn down your house and make you go blind.





\section{Don’t underline}
Underlining text (or mathematics) works well on the blackboard, in handwritting and for typewriters.
Don’t do it in \hologo{LaTeX}.





\section{Don’t use \commandtt{limits}}

For the love of God, please don’t.
People seem to think that they have to add \commandtt{limits} after a command to add limits to it:
\begin{tcblisting}{listing side text, title = {Wrong}}
\[
  \sum\limits_{k=1}^n k
  =
  \frac{n(n+1)}{2}
\]
\end{tcblisting}
But this is not only unnecessary, but also dangerous.
It is unnecessary because (most of) the commands in questions already have this functionality built in:
\begin{tcblisting}{listing side text, title = {Right}}
\[
  \sum_{k=0}^n k
  =
  \frac{n(n+1)}{2}
\]
\end{tcblisting}
This built-in limits have the advantage that they can distinguish between inline math and display math math:
\begin{tcblisting}{listing side text, title = {Inline vs.\ display}}
The sum $\sum_{k=0}^n 2^k = 2^{n+1} - 1$ is inline while the sum
\[
  \sum_{k=0}^n 3^k
  \neq
  3^{n+1} - 1
\]
is in display mode.
\end{tcblisting}
We can see that the inline version does not only use the smaller summation sign, but also sets the limits to the right instead of above the top and below the bottom of the summation sign.
This is a feature---a feature that the \commandtt{limits} version is missing:
\begin{tcblisting}{listing side text, title = {Wrong}}
So here is some text which will generate some lines.
The text itself isn’t important, but we really want it to fill some lines.
The important thing is the sum $\sum\limits_{k=0}^n k$.
Well, not really the sum itself, but its typesetting using the \commandtt{limits} command.
I think you know what I mean.
\end{tcblisting}
The limits are still placed above the top and below the summation sign.
This has it’s price:
The line in which the sum resides breaks the usual vertical space between lines, which gives the text an inconsistent and unorganized look.
Compare this to the version without \commandtt{limits}:
\begin{tcblisting}{listing side text, title = {Right}}
So here is some text which will generate some lines.
The text itself isn’t important, but we really want it to fill some lines.
The important thing is the sum $\sum_{k=0}^n k$.
Well, not really the sum itself, but its typesetting without the \commandtt{limits} command.
\end{tcblisting}
Here the line distance is nicely consistent and pleasing to the eye.

The usual predefined commands on which one would expect limits already have them defined, e.g.\ \commandtt{sum}, \commandtt{prod} or \commandtt{lim}, as the following example shows:
\begin{tcblisting}{listing side text, title = {Inline vs. display (again)}}
Compare the inline versions $\sum_{k=0}^n k$ and $\prod_{k=1}^n k$ and $\lim_{n \to \infty} a_n$ with the display versions
\[
  \sum_{k=0}^n k \,,
  \quad
  \prod_{k=1}^n k \,,
  \quad
  \lim_{n \to \infty} a_n \,.
\]
\end{tcblisting}
When one defines custom commands using \commandtt{DeclareMathOperator} and \commandtt{operatorname} one can make them support limits by using \commandtt{DeclareMathOperator*} and \commandtt{operatorname*} instead.
Suppose for examlp that we make in the preamble the following definition:
\begin{tcblisting}{listing only, title={Using \commandtt{DeclareMathOperator*}}}
\DeclareMathOperator*{\colim}{colim}
\end{tcblisting}
We can then do the following:
\begin{tcblisting}{title = {Using \commandtt{colim}}}
Inline we have $\colim_{X' \leq X} F(X')$ and in display mode we get
\[
  \colim_{X' \leq X} F(X') \,.
\]
\end{tcblisting}
The command \commandtt{operatorname*} was \commandtt{operatornamewithlimits} in the past, but this version should no longer be used.

If for some extremly strange reason one \textit{really}%
\footnote{This is basically never the case.
If you think that you’re the exception then you are most probably not.}
needs the limits to be in display style, then on should commit to it, by using \commandtt{displaystyle}.
Consider the following example:
\begin{tcblisting}{listing side text, title = {Without \commandtt{displaystyle}}}
\[
  \begin{pmatrix*}[l]
      \sum_{k=0}^n k
    & \sum_{k=0}^n k^2
    \\
      \sum_{k=0}^n k^3
    & \sum_{k=0}^n k^4
  \end{pmatrix*}
\]
\end{tcblisting}
By using \commandtt{displaystyle} we get the following result:
\begin{tcblisting}{listing side text, title = {With \commandtt{displaystyle}}}
\[
  \begin{pmatrix*}[l]
      \displaystyle \sum_{k=0}^n k
    & \displaystyle \sum_{k=0}^n k^2
    \\
      \displaystyle \sum_{k=0}^n k^3
    & \displaystyle \sum_{k=0}^n k^4
  \end{pmatrix*}
\]
\end{tcblisting}
In these examples one can also put a bit of space between the rows of the matrix by using \texttt{\tbs\tbs[height]} instead of just \texttt{\tbs\tbs}, as the following example shows:
\begin{tcblisting}{listing side text, title = {With \commandtt{displaystyle} and spacing}}
\[
  \begin{pmatrix*}[l]
      \displaystyle \sum_{k=0}^n k
    & \displaystyle \sum_{k=0}^n k^2
    \\[1.6em]
      \displaystyle \sum_{k=0}^n k^3
    & \displaystyle \sum_{k=0}^n k^4
  \end{pmatrix*}
\]
\end{tcblisting}





\section{Use \texorpdfstring{$\mathrm{d}x$}{dx} instead of \texorpdfstring{$dx$}{dx}}

A differential is written as \texttt{{\tbs}mathrm\{d\}x}, not as $dx$.
When it occurs at the end of an integral then a slight spacing \texttt{{\tbs},} is also introduced.
The following are therefore \textbf{wrong}:
\begin{tcblisting}{listing side text, title = {Wrong}}
\[
  \int_a^b f(x) dx
  \quad
  \int_a^b f(x) \mathrm{d}x
\]
\end{tcblisting}
The following is right:
\begin{tcblisting}{listing side text, title = {Right}}
\[
  \int_a^b f(x) \,\mathrm{d}x
\]
\end{tcblisting}





\section{Know your dots}
Ellipsis should \textbf{never} by written as \texttt{...} (three single dots), see the following horrible example:
\begin{tcblisting}{listing side text, title = {Wrong}}
$a + ... + b$
\end{tcblisting}
\hologo{LaTeX} instead provides different kinds of ellipses to use in math mode, namely
\begin{center}
    \commandtt{dotsb},
    \quad
    \commandtt{dotsc},
    \quad
    \commandtt{dotsm},
    \quad
    \commandtt{dotsi},
    \quad
    \commandtt{dotso},
    \\
    \commandtt{cdots},
    \quad
    \commandtt{ddots},
    \quad
    \commandtt{vdots},
    \quad
    \commandtt{ldots}.
\end{center}
Each of these have they own role and (mostly) distinct look and feel.
There are two groups of ellipses.
The first group consists of \commandtt{dotsb}, \commandtt{dotsc}, \commandtt{dotsm}, \commandtt{dotsi},\commandtt{dotso}, whereas the second group consists of \commandtt{cdots}, \commandtt{ddots}, \commandtt{vdots}, \commandtt{ldots}.

The ellipses in the first group are named after they function:
The ellipsis \commandtt{dotsb} for binary, \commandtt{dotsc} for comma, \commandtt{dotsm} for multiplication, \commandtt{dotsi} for integrals and \commandtt{dotso} for other.
The usage and look of the first three are as follows:
\begin{tcblisting}{listing side text, title = {Different dots}}
\begin{gather*}
  \sum_{i=1}^n x_i
  =
  x_1 + \dotsb + x_n 
  \\
  1 \leq \dotsb \leq n 
  \\
  i = 1, \dotsc, m
  \\
  \int_{a_1}^{b_1}
  \dotsi
  \int_{a_n}^{b_n}
  \\
  \prod_{i=1}^n x_i
  =
  x_1 \dotsm x_n
\end{gather*}
\end{tcblisting}
The command \commandtt{dotso} is meant for other, more unspecific cases.
Note that the members of this group all have names of the form \commandtt{dots*}, where \texttt{*} is a letter that specifies the semantic use of the dots.

The ellipses in the second group are not named after their function but after their look:
The ellipsis \commandtt{cdots} is vertically centered, \commandtt{ddots} is diagonal (from the top left to the bottom right), \commandtt{vdots} is horizontally centered, and \commandtt{ldots} is vertically lowered.
The first three of these ellipses are usually used in matrices:
\begin{tcblisting}{listing side text, title = {Different dots again}}
\[
  \begin{pmatrix}
    a_{11} & \cdots & a_{1n} \\
    \vdots & \ddots & \vdots \\
    a_{n1} & \cdots & a_{nn}
  \end{pmatrix}
\]
\end{tcblisting}
The command \commandtt{ldots} can for example be used to denote left out digits or symbols.
\begin{tcblisting}{listing side text, title = {Use of \commandtt{ldots}}}
We find that
\[
  x = 0.1234567891011\ldots
\]
Consider now the word $w = a_1 \ldots a_n$ where $a_1, \dotsc, a_n$ are letters in an alphabet $\Sigma$.
\end{tcblisting}
Note that the members of this second group of dots all have names of the form \texttt{*dots}, where \texttt{*} is a letter that specified the positioning of these dots.

The following should \textbf{never} to denote a product:
\begin{tcblisting}{listing only, title = {Wrong}}
x_1 \cdots {any kind of dots} \cdot x_n
\end{tcblisting}
So all of the following are \textbf{wrong}, and some of them look even worse then the other ones.
\begin{tcblisting}{listing side text, title = {Wrong}}
\begin{gather*}
  x_1 \cdot \dotsb \cdot x_n \\
  x_1 \cdot \dotsc \cdot x_n \\
  x_1 \cdot \dotsm \cdot x_n \\
  x_1 \cdot \dotsi \cdot x_n \\
  x_1 \cdot \cdots \cdot x_n \\
  x_1 \cdot \ldots \cdot x_n
\end{gather*}
\end{tcblisting}
(The author hopes that nobody is stupid enough to even trying using \commandtt{ddots} or \commandtt{vdots} in this situation.)

So overall one should use \commandtt{cdots}, \commandtt{ddots} and \commandtt{vdots} for matrices, and otherwise the commands \commandtt{dotsb}, \commandtt{dotsc}, \commandtt{dotsm}, \commandtt{dotsi} or \commandtt{dotso} depending on the context.

There also exists the generic command \commandtt{dots} which tries to automagically use the right kind of positioning and spacing.





\section{Don’t use \texttt{\$\$  \$\$} or \texttt{eqnarray}}

There are many good ways to put mathematical content into display mode, but \texttt{\$\$  \$\$} and \texttt{eqnarray} are none of them.
The method \texttt{\$\$  \$\$} is too level for practical use, and \texttt{eqnarray} has too many problems and has been deprecated since forever.
One can use any of the following, depending on the planned usage.

% TODO: Flowchart


\subsection{\texttt{equation*} and \texttt{{\tbs}[ {\tbs}]}}
The methods \texttt{equation*} and \texttt{{\tbs}[ {\tbs}]} can be used for a single line of display math mode.
Both commands do the same thing (when \texttt{amsmath} is loaded).
\begin{tcblisting}{listing side text, title = {Using {\tbs}[ {\tbs}] and \texttt{equation*}}}
Suppose that both the formula
\[
  a + b = c
\]
and the formula
\begin{equation*}
  2a - b = c \,.
\end{equation*}
hold.
Then $a$ and $b$ are unique.
\end{tcblisting}
The non-starred version \texttt{equation} numbers the equation.
\begin{tcblisting}{listing side text, title = {Using \texttt{equation}}}
The formula
\begin{equation}
  a^2 - b^2 = (a + b)(a - b)
\end{equation}
is one of the binomial formulas.
\end{tcblisting}

% One of the nice properties of these commands is that they adjust the spacing around the display mode mathematics depending on the surrounding text.
% Consider the following example:
% \begin{LTXexample}[pos = r]
%   Short
%   \[
%     a = b \,.
%   \]
%   Longer text than the short one above.
% \end{LTXexample}
% There is actually less spacing between the above text and the display mode then there is between the bottom text and the display mode.
% But in the following example both have the same spacing:
% \begin{LTXexample}[pos = r]
%   A long text above.
%   \[
%     a = b \,.
%   \]
%   Also a long text below
% \end{LTXexample}



\subsection{\texttt{gather*}}

The \texttt{gather*} environment is meant for multiple lines that are non-aligned but centered instead.
\begin{tcblisting}{title = {Using \texttt{gather*}}}
We consider for every integer $n \geq 0$ the polynomial
\[
  p_n
  =
  \sum_{k=0}^n x^k \,.
\]
In particular
\begin{gather*}
  p_0 = 1 \,,
  \qquad
  p_1 = 1 + x \,,
  \qquad
  p_2 = 1 + x + x^2 \,,
  \qquad
  p_3 = 1 + x + x^2 + x^3 \,,
  \\
  p_4 = 1 + x + x^2 + x^3 + x^4 \,,
  \qquad
  p_5 = 1 + x + x^2 + x^3 + x^4 + x^5 \,.
\end{gather*}
\end{tcblisting}
The non-starred version \texttt{gather} number the lines.
\begin{tcblisting}{title = {Using \texttt{gather}}}
We have the polynomials
\begin{gather}
  p_0 = 1 \,,
  \qquad
  p_1 = 1 + x \,,
  \qquad
  p_2 = 1 + x + x^2 \,,
  \qquad
  p_3 = 1 + x + x^2 + x^3 \,,
  \\
  p_4 = 1 + x + x^2 + x^3 + x^4 \,,
  \qquad
  p_5 = 1 + x + x^2 + x^3 + x^4 + x^5 \,.
\end{gather}
\end{tcblisting}



\subsection{\texttt{align*} and \texttt{alignat*}}

The \texttt{align*} enviroment takes multiple lines which can aligned.
Each line contains the symbol \texttt{\&} once, and the occurences of this symbol are then aligned.
\begin{tcblisting}{listing side text, title = {Using \texttt{align*}}}
We find that
\begin{align*}
  a + b + c
  &=
  d + e + f + g + h
  \\
  &=
  i + j + k + l
  \\
  &=
  m + n + o + p + q \,.
\end{align*}
\end{tcblisting}
The unstarred version \texttt{align} again numbers the lines.
\begin{tcblisting}{listing side text, title = {Using \texttt{align}}}
We find again that
\begin{align}
  a + b + c
  &=
  d + e + f + g + h
  \\
  &=
  i + j + k + l
  \\
  &=
  m + n + o + p + q \,.
\end{align}
\end{tcblisting}
One can also use multiple aligned columns, which then need to be separated by an additional \texttt{\&}.
For~$n$ aligned columns we hence need~$2n+1$ occurences of \texttt{\&}.
\begin{tcblisting}{title = {Multicolumn \texttt{align*}}}
We consider the values
\begin{align*}
  x_1 &= 1 \,,  &   x_2 &= 2 \,,  &   x_3 &= 3 \,,  \\
  x_4 &= 4 \,,  &   x_5 &= 5 \,,  &   x_6 &= 6 \,,  \\
  x_7 &= 7 \,,  &   x_8 &= 8 \,,  &   x_9 &= 9 \,.
\end{align*}
\end{tcblisting}

The \texttt{alignat*} environment is similar to the \texttt{align} environment, but doesn’t add any built-in spacing between the aligned columns.
Any such spacing must therefore by added by hand.
One also has to specify the number of columns beforehand.
\begin{tcblisting}{title = {Using \texttt{alignat*}}}
We also consider the values
\begin{alignat*}{3}
  y_1 &= 9 \,,  &\qquad   y_2 &= 8 \,,  &\qquad   y_3 &= 7 \,,  \\
  y_4 &= 6 \,,  &         y_5 &= 5 \,,  &         y_6 &= 4 \,,  \\
  y_7 &= 3 \,,  &         y_8 &= 2 \,,  &         y_9 &= 1 \,.
\end{alignat*}
\end{tcblisting}
When aligning multiple columns one should use \texttt{alignat*} instead of \texttt{align*} to get (manually) a good looking distance between the aligned columns.



\subsection{Don’t: \texttt{center} with \texttt{\$ \$}}

By all that is holy, don’t do the following:
\begin{tcblisting}{listing side text, title={Wrong}}
Some text that ends in
\begin{center}
  $a + b = c$.
\end{center}
Now some more text.
\end{tcblisting}



\subsection{\texttt{gathered}, \texttt{aligned} and \texttt{alignedat}}

The environments \texttt{gathered}, \texttt{aligned} and \texttt{alignedat} are variations of the environments \texttt{gather*}, \texttt{align*} and \texttt{alignat*}.
These variations are meant to be used inside an already existing math environment.
\begin{tcblisting}{title={Use of \texttt{aligned}}}
\[
  \left\{
    \begin{aligned}
      a + b &= c      \\
      d     &= e + f
    \end{aligned}
  \right\}
\]
\end{tcblisting}




\subsection{Overview}

One should always use the most basic environment that does the job:
Using overpowered environments can lead to unexpected problems.
Consider the following example:
\begin{tcblisting}{title = {Wrong use of \texttt{align*}}}
\begin{align*}
  ABCD = EF = GHI = JKL = M = NOP
  \\
  QRS = TUV = WX = Y = Z
\end{align*}
\end{tcblisting}
The \texttt{align*} environment automatically alignes both lines on the right since no information about alignment was given.
In the above situation one should use \texttt{gather*} instead.
\begin{tcblisting}{title = {Right use of \texttt{gather*}}}
\begin{gather*}
  ABCD = EF = GHI = JKL = M = NOP
  \\
  QRS = TUV = WX = Y = Z
\end{gather*}
\end{tcblisting}
It is quite easy to figure out what kind of environment is needed:
\begin{center}
\begin{tikzpicture}[
  node distance = 5em,
  >={Latex[width=2mm,length=2mm]},
  every text node part/.style = { align = center },
  start/.style    = { rectangle,
                      rounded corners,
                      fill = green!20!white,
                      draw = black,
                      minimum width  = 5em,
                      minimum height = 2em
                    },
  question/.style = { rectangle,
                      rounded corners,
                      fill = black!10!white,
                      draw = black,
                      minimum width  = 9em,
                      minimum height = 2.5em
                    },
  answer/.style   = { rectangle,
                      rounded corners,
                      draw = black,
                      minimum width  = 7em,
                      minimum height = 1.5em
                    }
]
  % nodes
  \node (start)
        [start]
        {formula};
  \node (multiline)
        [question, below of = start]
        {multiline?};
  \node (alignment)
        [question, below of = multiline]
        {alignment?};
  \node (multicolumn)
        [question, below of = alignment]
        {multiple columns?};
  \node (equation)
        [answer, right of = multiline, xshift = 7em]
        {\texttt{{\tbs}[ {\tbs}]}\\equation*};
  \node (gather)
        [answer, right of = alignment, xshift = 7em]
        {gather*};
  \node (align)
        [answer, right of = multicolumn, xshift = 7em]
        {align*};
  \node (alignat)
        [answer, below of = align]
        {alignat*};
  % arrows
  \draw[->] (start) -- (multiline);
  \draw[->] (multiline)   -- node[anchor=south] {no} (equation);
  \draw[->] (multiline)   -- node[anchor=east] {yes} (alignment);
  \draw[->] (alignment)   -- node[anchor=south] {no} (gather);
  \draw[->] (alignment)   -- node[anchor=east] {yes} (multicolumn);
  \draw[->] (multicolumn) -- node[anchor=south] {no} (align);
  \draw[->] (multicolumn) |- node[anchor=east, yshift=1.7em] {yes} (alignat);
\end{tikzpicture}
\end{center}
If numbering of the line(s) is needed then the unstarred version is to be used.
(The above flowchart is partly inspired by \cite{flowchart}.)





\section{When breaking lines, do it with thought}

When using multiline environments like \texttt{align*} and \texttt{gather*} one is forced to split up the given text in multiple parts, and often also to align them.
The breaking points and places of alignment need to be choosen 
Most of the time it sufficies to distinguish between the following three options:
\begin{itemize}
  \item
    If everything fits into a single line and looks good, then don’t use \texttt{align*} or \texttt{alignat*}, but \texttt{{\tbs}[ {\tbs}]} or \texttt{equation*} instead.
    But don’t do the following:
    \begin{tcblisting}{title = {Wrong}}
Here is some text.
This text is just long enough to fill out a complete line.
\[
  ab = cd = ef = gh = ij = kl = mn = pq = rs = st = uv = vw = xy = z \,.
\]
Here is some more text.
This text is again long enough to fill out at least one complete line.
    \end{tcblisting}
    The formula in display style looks and feels far too long and should be split up.
  \item
    Align all relation symbols underneath each other so that all but the first term are on the right side:
    Then
    \begin{tcblisting}{title = {Right}}
Let $x$,$y$ be two nilpotent elements in a commutative ring $R$.
Then
\begin{align*}
  \exp(x) \exp(y)
  &=
  \left( \sum_{k=0}^\infty \frac{x^k}{k!} \right)
  \left( \sum_{l=0}^\infty \frac{y^l}{l!} \right)
  \\
  &=
  \sum_{k,l=0}^\infty \frac{x^k y^l}{k! \, l!}
  \\
  &=
  \sum_{n=0}^\infty \, \sum_{k+l = n} \frac{x^k y^l}{k! \, l!}
  \\
  &=
  \sum_{n=0}^\infty \frac{1}{n!} \sum_{k=0}^n \binom{n}{k} x^k y^{n-k}
  \\
  &=
  \sum_{n=0}^\infty \frac{1}{n!} (x + y)^n
  \\
  &=
  \exp(x + y) \,.
\end{align*}
    \end{tcblisting}
  \item
    Aligning all relation symbols to the left:
    \begin{tcblisting}{title = {Right}}
Let~$R$ and~$S$ be two commutative rings.
Then for every~$(r,s) \in R \times S$,
\begin{align*}
  {}&
  (r, s) \in (R \times S)^\times
  \\
  \iff{}&
  \text{there exist $(r', s') \in R \times S$ with $(r,s)(r',s') = (1,1)$}
  \\
  \iff{}&
  \text{there exist $r' \in R$ and $s' \in S$ with $rr' = r$ and $ss' = 1$}
  \\
  \iff{}&
  \text{$r \in R^\times$ and $s \in S^\times$}
  \\
  \iff{}&
  (r,s) \in R^\times \times S^\times \,,
\end{align*}
and therefore $(R \times S)^{\times} = R^\times \times S^\times$.
    \end{tcblisting}
    The empty pair of curly brackets in \texttt{{\tbs}iff\{\}\&} ensures that the spacings coming from \commandtt{iff} and \texttt{\&} do not interfere with each other.
    Otherwise something like this happens:
    \begin{tcblisting}{title = {Wrong}}
      \begin{align*}
         &\text{some stuff} \\
        =&\text{some other stuff}
      \end{align*}
    \end{tcblisting}
\end{itemize}

One should always keep in mind that breaking up a formula over multiple lines isn’t just meant to prevent overlong lines, but more importantly to let the resulting output display the structure, and thus part of the content, of the formula.
A badly broken up formula is harder to understand for both the reader and the author.






\section{Use \texttt{intertext} and \texttt{shortintertext}}

Multiline environments like \texttt{gather*} and \texttt{align*} can be interrupted by using \commandtt{intersect} and \commandtt{shortintertext} to insert some text between different lines of mathematics.
This is particularly useful to combine two \texttt{align*} environments into a single \texttt{align*} environment, which allows for a common alignment of both sections.

The following is an example for what we \textbf{don’t want}:
\begin{tcblisting}{listing side text, title = {Wrong}}
We consider the equalities
\begin{align*}
  H
  &=
  a_1 + a_2 + a_3 + a_4
  \\
  &=
  b_1 + b_2 + b_3 + b_4 + b_5 + b_6
  \\
  &=
  c_1 + c_2 + c_3 + c_4 + c_5
\end{align*}
and
\begin{align*}
  I
  &=
  d_1 + d_2 + d_3 + d_4 + d_5 + d_6
  \\
  &=
  e_1 + e_2 + e_3
  \\
  &=
  f_1 + f_2 + f_3 + f_4 + f_5 \,.
\end{align*}
\end{tcblisting}
Note the annoying misalignment of the equality signs of the two \texttt{align*} environments.
We can solve this problem by using only one \texttt{align*} environment and inserting the text \enquote{and} by using the \commandtt{intertext} command:
\begin{tcblisting}{listing side text, title = {Right}}
We consider now the equalities
\begin{align*}
  H
  &=
  a_1 + a_2 + a_3 + a_4
  \\
  &=
  b_1 + b_2 + b_3 + b_4 + b_5 + b_6
  \\
  &=
  c_1 + c_2 + c_3 + c_4 + c_5
\intertext{and}
  I
  &=
  d_1 + d_2 + d_3 + d_4 + d_5 + d_6
  \\
  &=
  e_1 + e_2 + e_3
  \\
  &=
  f_1 + f_2 + f_3 + f_4 + f_5 \,.
\end{align*}
\end{tcblisting}
The \texttt{shortintertext} functions in the same way as \texttt{intertext} but inserts less space between the two equations.
To see the effects of \texttt{shortintertext} let us start with the following example:
\begin{tcblisting}{title = {Wrong}}
First we have some lengthy text above the matical formulas, followed by the formulas
\[
  a = b
\]
and
\[
  b = a \,.
\]
We finish off by writing some more text after the above mathematical two formulas.
\end{tcblisting}
We naturally want to align the two equality signs, which we by using a single \texttt{align*} environment together with \texttt{intertext}, as explained above:
\begin{tcblisting}{title = {Wrong again}}
First we have some lengthy text above the matical formulas, followed by the formulas
\begin{align*}
  a &= b
\intertext{and}
  b &= a \,.
\end{align*}
We finish off by writing some more text after the above mathematical two formulas.
\end{tcblisting}
But we can seet that the inserted \texttt{intersect} puts a large space between the two formulas, much too large for our taste.
We can solve this problem by using \texttt{shortintertext} instead of \texttt{intertext}, as the following example shows:
\begin{tcblisting}{title = {Right}}
First we have some lengthy text above the matical formulas, followed by the formulas
\begin{align*}
  a &= b
\shortintertext{and}
  b &= a \,.
\end{align*}
We finish off by writing some more text after the above mathematical two formulas.
\end{tcblisting}





\section{Use the right kind of matrix}

The following are the usual kinds of matrices.
\begin{tcblisting}{listing side text, title = {Different kinds of matrices}}
\begin{gather*}
  \begin{matrix}
    a & b \\
    c & d
  \end{matrix}
  \\
  \begin{pmatrix}
    a & b \\
    c & d
  \end{pmatrix}
  \\
  \begin{bmatrix}
    a & b \\
    c & d
  \end{bmatrix}
  \\
  \begin{vmatrix}
    a & b \\
    c & d
  \end{vmatrix}
\end{gather*}
\end{tcblisting}
There alse exist starred versions of these matrix environments that allow to specify the alignment of its columns.
(The standard is centered.)
\begin{tcblisting}{listing side text, title = {Aligned matrices}}
\begin{gather*}
  \begin{matrix*}[r]
      a & -b \\
     -c &  d
  \end{matrix*}
  \qquad
  \begin{pmatrix*}[c]
    a & -b \\
    -c &  d
  \end{pmatrix*}
\\
  \begin{bmatrix*}[l]
     a & -b \\
    -c &  d
  \end{bmatrix*}
  \qquad
  \begin{vmatrix}
     a & -b \\
    -c &  d
  \end{vmatrix}
\end{gather*}
\end{tcblisting}
There are also small versions of all of the above:
\begin{tcblisting}{title = {Small matrices}}
\begin{gather*}
  \begin{smallmatrix}
    a & b \\
    c & d
  \end{smallmatrix}
  \qquad
  \begin{psmallmatrix}
    a & b \\
    c & d
  \end{psmallmatrix}
  \qquad
  \begin{bsmallmatrix}
    a & b \\
    c & d
  \end{bsmallmatrix}
  \qquad
  \begin{vsmallmatrix}
    a & b \\
    c & d
  \end{vsmallmatrix}
\\
  \begin{smallmatrix*}[r]
    -a &  b \\
      c & -d
  \end{smallmatrix*}
  \quad
  \begin{psmallmatrix*}[c]
    -a &  b \\
      c & -d
  \end{psmallmatrix*}
  \quad
  \begin{bsmallmatrix*}[l]
    -a &  b \\
      c & -d
  \end{bsmallmatrix*}
  \quad
  \begin{vsmallmatrix}
    -a &  b \\
      c & -d
  \end{vsmallmatrix}
\end{gather*}
\end{tcblisting}
One needs to choose the type of matrix depending on the context:
\begin{tcblisting}{listing side text, title = {Using the right kind of matrix}}
We consider the morphism
\[
  X \oplus Y
  \xrightarrow{\,
    \begin{bsmallmatrix*}[r]
      f & -d \\
      0 &  g
    \end{bsmallmatrix*}
    \,
  }
  X' \oplus Y' \,.
\]
\end{tcblisting}



\backmatter


\printbibliography





\end{document}
